.PHONY: generate-config
generate-config:
	kubectl create configmap config --from-file=config.yaml=config/config.yaml --dry-run -o yaml > prow/config.yaml
	kubectl create configmap plugins --from-file=plugins.yaml=config/plugins.yaml --dry-run -o yaml > prow/plugins.yaml
	scripts/make-jobs-config.sh > prow/jobs.yaml
	for f in config plugins jobs; do printf '#############\n###\n### THIS IS AN AUTOGENERATED FILE!!! DO NOT EDIT THIS FILE DIRECTLY!!!\n###\n#############\n\n%s\n' "$$(cat prow/$${f}.yaml)" > prow/$${f}.yaml; done

.PHONY: verify-config
verify-config: checkconfig
	${GOPATH}/bin/checkconfig --config-path=config/config.yaml --job-config-path=config/jobs --plugin-config=config/plugins.yaml
	make generate-config
	if [ "$$(git status -s)" != "" ]; then git diff; exit 1; fi

checkconfig:
	go get k8s.io/test-infra/prow/cmd/checkconfig
	go install k8s.io/test-infra/prow/cmd/checkconfig
